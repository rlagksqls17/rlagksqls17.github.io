---
layout: post
title: "WMS sequencing tech 2- QC와 트리밍"
categories: project
tags: test
last_modified_at: 2024-05-17T08:00:00~18:00
---


### 0. QC와 트리밍 개요  

QC는 Quality Control의 줄임말로, 이 QC과정을 거쳐 sequencing data 품질을 평가하고, 또한 트리밍 (trimming)이라는 과정을 통해 해당 데이터의 품질을 개선한다.  

---  

### 1. sequence data에서 quality란?

언뜻 보기에는 sequence data에 quality란게 어디 있다는 건지 감을 잡기 힘들 수도 있다. 보통 sequence data라 함은 3'-AGCGGCCCC-5'와 같이, 연구자가 PCR (polymerase chain reaction)로 증폭시킨 DNA 라이브러리 내 각각의 리드를, 시퀀싱 기계를 통해 읽어 내고 난 뒤의 데이터를 말한다.  

일루미나 사의 NGS sequencing을 예로 들어 더 자세히 설명하자면, 이렇게 PCR로 증폭시킨 각각의 리드들이 담긴 DNA 라이브러리가 있다고 가정해보자. 각각의 리드에 대해서 서열을 읽기 위해, 형광을 붙인 dNTP (deoxynucleotide)를 "흘려" 보낸다. 흘려보낸 뉴클레오타이드가 상보성에 의해 각 리드의 서열에 결합할 때마다 형광이 방출되고, 기계는 그 형광을 읽어 결과적으로 리드별 sequencing data를 기록한다 [(NGS sequencing에 대한 더 자세한 영상링크)](https://www.illumina.com/science/technology/next-generation-sequencing/plan-experiments/quality-scores.html).   

**이때 다양한 sequencing error가 발생할 수 있고, 기계는 그러한 오류율을 계산하여 읽은 서열의 품질로서 기록한다.** 품질이 떨어지는 일부 사례에 대한 [관련 링크](https://www.ecseq.com/support/ngs/why-does-the-sequence-quality-decrease-over-the-read-in-illumina)를 올려두었으니 도움이 되었으면 좋겠다.   

이러한 오류율을 "Quality score"라 한다. 즉 염기가 잘못 호출되어 읽힐 확률이다. 다음 표를 보자.  

|Phred Quality Score|Probability of incorrect base call|Base call accuracy|
|------|---|---|
|10|1 in 10|90%|
|20|1 in 100|99%|
|30|1 in 1000|99.9%|
|40|1 in 10000|99.99%|
|50|1 in 100000|99.999%|

여기서 어떤 하나의 염기에 대한 Phred Quality Score가 30이라면, 이는 오류율이 0.1% (정확도 99.9%)라는 것을 의미하고, 흔히 이 Phred Quality Score에 33을 더하여 ASCII code로 변환한 Sanger format을 이용하여 다음에 설명할 FASTQ 형식의 파일에 기록해둔다. 

---  

### 2. FASTQ  

FASTQ 형식의 파일은 너무도 잘 알려져 있기 때문에, 간단하게 아래 사진으로 정리해두었다.  

![Imgur](https://imgur.com/VzLPvfe.jpg)

---  

### 3. FASTQC 및 관련 코드  

FASTQ 내 수많은 리드들의 품질을 여러 방면에서 검사하여 report 형식으로 output을 내주는, 가장 유명한 툴이 바로 [FASTQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/)이다.  

QC할 파일이 너무 많을 경우를 생각해 본인은 다음과 같은 코드를 작성해두었다.  

파이썬의 상세 코드 설명은 추후에 천천히 다루려고 한다. 지금은 우선 주석만 표기해두었다.

현재 폴더 내 모든 파일들을 인식하게 한 뒤, 그 파일 하나하나를 fastqc 명령어 적용하게끔 하는 단순한 코드이다. 이 코드도 멀티프로세싱 관련하여 단점이 있는데, 그건 글의 요지와 맞지 않으므로 일단 나중에.. 하하 

```python  
import os

def main():
    input_path = "/input_path/"
    output_path = "/output_path/"
    file_list = os.listdir(input_path)
    processing_count = 0  # 프로세스 진행 카운트 기록

    for f in file_list[start_index]:
        processing_count += 1
        print(processing_count)

        # fastqc [-o output dir] [--(no)extract] [-f fastq|bam|sam]  [-c contaminant file] seqfile1 .. seqfileN
        os.system(f"nohup fastqc -o {output_path} -f fastq {input_path}/{f}")  

main()
```  

---  

### 4. FASTQC output  

명령어를 돌린 후에 나오는 output html 코드를 예시로 가져와봤다. 하나하나 살펴보자.  

---

<div class="module"><h2 id="M0"><img src="data:image/png;base64,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" alt="[OK]"/>Basic Statistics</h2><table><thead><tr><th>Measure</th><th>Value</th></tr></thead><tbody><tr><td>Filename</td><td>SRR5579973_20V5_P4_1.fastq</td></tr><tr><td>File type</td><td>Conventional base calls</td></tr><tr><td>Encoding</td><td>Sanger / Illumina 1.9</td></tr><tr><td>Total Sequences</td><td>10560182</td></tr><tr><td>Sequences flagged as poor quality</td><td>0</td></tr><tr><td>Sequence length</td><td>151</td></tr><tr><td>%GC</td><td>45</td></tr></tbody></table></div>    

---  

